---
title: è¯•ä¸‹å¾®è°ƒ GPT-3 åšä¸€ä¸ªå¿ƒç†é—®ç­”æœºå™¨äºº
date: 2023-04-26
tags: 
  - GPT-3
  - å¾®è°ƒ
  - é—®ç­”
  - Colab
  - OpenAI
  - Python
---

# è¯•ä¸‹å¾®è°ƒ GPT-3 åšä¸€ä¸ªå¿ƒç†é—®ç­”æœºå™¨äºº

> âœ¨æ–‡ç« æ‘˜è¦ï¼ˆAIç”Ÿæˆï¼‰

<!-- DESC SEP -->

ç¬”è€…åœ¨è¿™ç¯‡æ–‡ç« ä¸­åˆ†äº«äº†å¦‚ä½•åˆ©ç”¨ GPT-3 å¾®è°ƒåˆ›å»ºä¸€ä¸ªå¿ƒç†é—®ç­”æœºå™¨äººã€‚

- é¦–å…ˆï¼Œç¬”è€…é€‰æ‹©äº† Google Colab ä½œä¸ºå¼€å‘ç¯å¢ƒï¼Œé¿å…äº†å¤æ‚çš„æœ¬åœ°ç¯å¢ƒé…ç½®
- æ¥ç€ï¼Œç¬”è€…è¯¦ç»†ä»‹ç»äº†å¦‚ä½•å®‰è£… OpenAI å‘½ä»¤è¡Œå·¥å…·å¹¶è®¾ç½® API_KEYï¼Œç¡®ä¿èƒ½å¤Ÿè°ƒç”¨ GPT-3 æœåŠ¡
- æ•°æ®é›†çš„å‡†å¤‡è‡³å…³é‡è¦ï¼Œç¬”è€…ä½¿ç”¨äº†ä¸¤ä»½å…¬å¼€çš„ä¸­æ–‡å¿ƒç†é—®ç­”æ•°æ®é›†ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºç¬¦åˆ`jsonl`æ ¼å¼çš„é—®ç­”å¯¹
- ä¸Šä¼ æ•°æ®åï¼Œç¬”è€…é€šè¿‡ç®€å•çš„å‘½ä»¤å¼€å§‹å¾®è°ƒæ¨¡å‹ï¼Œå¹¶å±•ç¤ºäº†å¦‚ä½•åœ¨å¾®è°ƒå®Œæˆåè¿›è¡Œè°ƒç”¨

å°½ç®¡ç»“æœå°šå¯æ¥å—ï¼Œä½†ç”±äºæ•°æ®é‡è¾ƒå°ï¼Œæ•ˆæœæœ‰é™ã€‚æœ€åï¼Œç¬”è€…è¡¨è¾¾äº†å¯¹æœªæ¥ API çš„æœŸå¾…ï¼Œå¹¶å›å¿†èµ·å­¦ä¹  Python çš„åˆè¡·ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸ä»…å±•ç¤ºäº†æŠ€æœ¯å®ç°ï¼Œä¹Ÿåæ˜ äº†ç¬”è€…çš„å­¦ä¹ ä¸æ¢ç´¢ç²¾ç¥ã€‚

<!-- DESC SEP -->

## å‰è¨€

æœ€è¿‘ï¼Œç¬”è€…åšçš„ä¸€ä¸ªå°ç¨‹åºè¿˜å·®æœ€åä¸€ä¸ªå¿ƒç†é—®ç­”çš„åŠŸèƒ½ï¼Œä¸»è¦åŠŸèƒ½åŸºæœ¬å°±å®Œæˆäº†ã€‚æˆ‘æƒ³å·ä¸ªæ‡’ï¼Œé‚£å°±è°ƒç”¨åˆ«äººçš„ API å§ï¼Œæ­£å¥½ GPT-3 éå¸¸ç«ï¼Œé‚£å°±è¯•è¯•ï¼Ÿ

## å‡†å¤‡

### Colab

è¿™æ˜¯ä¸€ä¸ªè°·æ­Œçš„çº¿ä¸Š jupyter-notebook ç½‘ç«™ï¼Œå¯ä»¥ç›´æ¥åœ¨ä¸Šé¢è¿è¡Œ Python ä»£ç ï¼Œéå¸¸æ–¹ä¾¿ï¼š

[ç½‘å€ä¼ é€é—¨](https://colab.research.google.com/)

æœ€å¥½å°±ç”¨è¿™ä¸ªå§ï¼Œç¯å¢ƒå•¥çš„éƒ½é…å¥½äº†ï¼Œç¬”è€…ä¹‹å‰çš„ç”µè„‘æœ‰è®¸å¤š python çš„ç¯å¢ƒï¼Œä½†æ¢ç”µè„‘ä¹‹åå°±å¥½ä¹…æ²¡å†™è¿‡ python äº†ï¼Œæ‰€ä»¥ä¹Ÿå·ä¸ªæ‡’ï¼Œä¸å®‰è£…ç¯å¢ƒäº†...

é¡ºä¾¿æä¸€ä¸‹ï¼Œå•çº¯ windows å¥½åƒä¸èƒ½ä½¿ç”¨ openai çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè€Œä¸€å° linux æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ï¼Œä½†å¦‚æœæ˜¯å›½å†…çš„æœåŠ¡å™¨å°±ä¼šè¢«å¢™ï¼Œéœ€è¦åœ¨å¯¹åº”æœåŠ¡å™¨ä¸Šå»æƒ³ä¸€äº›åŠæ³•ã€‚

æ‰€ä»¥ï¼Œæ¨èç”¨è¿™ä¸ª...

### openai å‘½ä»¤è¡Œå·¥å…·

åœ¨`jupyter`çš„å•å…ƒæ ¼é‡Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤å®‰è£…ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå°±å’Œä½ `npm i -g nest`ä¸€æ ·ï¼š

```python
!Â pipÂ installÂ --upgradeÂ openai
```

![](https://oss.justin3go.com/blogs/Pasted%20image%2020230426165325.png)

Successfully installedğŸ‰ğŸ‰ğŸ‰

### ä¸€ä¸ª API_KEY

åœ¨[è¿™é‡Œ](https://platform.openai.com/account/api-keys)åˆ›å»ºå¹¶å¤åˆ¶ä¿å­˜å°±å¯ä»¥äº†

ç„¶åç»§ç»­åœ¨åˆšæ‰çš„`jupyter`ä¸‹é¢å°†è¿™ä¸ª`API_KEY`å¯¼å‡ºä¸ºç¯å¢ƒå˜é‡ï¼š

```python
importÂ os

os.environ['OPENAI_API_KEY']Â =Â '<your api key>'
```

![](https://oss.justin3go.com/blogs/Pasted%20image%2020230426165806.png)

é¡ºä¾¿æä¸€ä¸‹ï¼šæ–°ç”¨æˆ·éƒ½æœ‰ 18 ç¾å…ƒçš„å…è´¹é¢åº¦å¯ä»¥è¯•ç”¨

## æ•°æ®é›†æ ¼å¼è¦æ±‚

é¦–å…ˆï¼Œopenai å®˜æ–¹æ–‡æ¡£ä¸Šæ˜ç¡®è¦æ±‚äº†ä¼ è¿‡å»çš„æ•°æ®é›†æ ¼å¼ä¸º[jsonl](https://jsonlines.org/)æ ¼å¼çš„æ–‡ä»¶ï¼Œå°±ä¸‰ç‚¹è¦æ±‚ï¼š

1. utf-8 ç¼–ç 
2. æ¯è¡Œä¸ºä¸€ä¸ªæ­£ç¡®çš„ JSON æ ¼å¼
3. æ¢è¡Œç¬¦ä¸º`\n`

æ²¡å•¥è¯´çš„ï¼Œå¦‚ä¸‹æ˜¯ä¸€ä¸ªç¬”è€…çš„æ•°æ®é›†æˆªå›¾ï¼š

![](https://oss.justin3go.com/blogs/Pasted%20image%2020230426163805.png)

ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™è¡Œå‘½ä»¤æ¥æ ¡éªŒä½ çš„æ•°æ®é›†æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼š

```shell
openaiÂ toolsÂ fine_tunes.prepare_dataÂ -fÂ "./2.jsonl"
```

## æ•°æ®å¤„ç†

å¦‚ä¸‹æ˜¯ç¬”è€…çš„ä¸¤ä¸ªæ•°æ®æºï¼ˆä¸­æ–‡å¿ƒç†é—®ç­”æ•°æ®é›†ï¼Œéƒ½æ˜¯å…¬å¼€çš„(*^_^*)ï¼‰ï¼š

- [Chinese-Psychological-QA-DataSet](https://github.com/flyrae/Chinese-Psychological-QA-DataSet)
- [efaqa-corpus-zh](https://github.com/chatopera/efaqa-corpus-zh)

æˆ‘ä»¬éœ€è¦å°†è¿™äº›æ•°æ®å¤„ç†é‡Œä¸º**é—®ç­”å¯¹**çš„æ¨¡å¼ï¼Œå¹¶éµå¾ªä¸Šé¢çš„`jsonl`æ ¼å¼ï¼š

```txt
{"prompt": "<prompt text>", "completion": "<ideal generated text>"}
{"prompt": "<prompt text>", "completion": "<ideal generated text>"}
{"prompt": "<prompt text>", "completion": "<ideal generated text>"}
...
```

ç”±äºæ•°æ®æ ‡æ³¨å¾—éå¸¸ç»™åŠ›ï¼Œç¬”è€…çš„æ•°æ®é›†å¤„ç†å°±éå¸¸ç®€å•äº†ï¼ŒåŸºæœ¬æ²¡åšä»€ä¹ˆå¤æ‚çš„è½¬æ¢...

### å¤„ç†ç¬¬ä¸€ä¸ªæ•°æ®æº

```python
import json
from tqdm import tqdm

with open("./dataset/src/ques_ans1.json") as f:
  file_contents = f.read()
  
# print(file_contents)
parsed_json = json.loads(file_contents)
print(len(parsed_json))
for item in tqdm(parsed_json):
  question = item["ques_info"]["title"] + item['ques_info']['content']
  for ans in item["answers_info"]:
    if ans["recommend_flag"] == "æ¨è":
      goodAns = ans["content"]
      result = { "prompt": question, "completion": goodAns }
      with open("./dataset/target/1.jsonl", "a") as f:
        f.write(json.dumps(result) + "\n")
```

éå¸¸ç®€å•çš„é€»è¾‘ï¼Œå°±ä¸è¿‡å¤šä»‹ç»äº†ï¼Œå°±æ˜¯é—®é¢˜ä¿ç•™ï¼Œç­”æ¡ˆåªè¦æ˜¯`æ¨è`ï¼Œå°±ä¸é—®é¢˜ç»„æˆä¸€ä¸ªé—®ç­”å¯¹ï¼Œé—®é¢˜å¯æ˜¯é‡å¤ä½¿ç”¨ï¼Œç›´åˆ°ç­”æ¡ˆç”¨å®Œï¼›å½“ç„¶è¿™æ®µä»£ç è¿˜æœ‰ä¼˜åŒ–ç©ºé—´ï¼Œä½†æ•°æ®é‡ä¸å¤šï¼Œå°±ç®—äº†ã€‚ç¬”è€…æ‡’ğŸ˜´

### å¤„ç†ç¬¬äºŒä¸ªæ•°æ®æº

```python
import json
from tqdm import tqdm

with open("./dataset/src/EFA_Dataset_v20200314_latest.txt") as f:
  lines = f.readlines()
  
for line in tqdm(lines):
  parsed_line = json.loads(line)
  question = parsed_line["title"]
  for chat in parsed_line["chats"]:
    label = chat["label"]
    if "knowledge" in label and label["knowledge"] == True and label["negative"] == False:
      goodAns = chat["value"]
      result = { "prompt": question, "completion": goodAns }
      with open("./dataset/target/2.jsonl", "a") as f:
        f.write(json.dumps(result) + "\n")
```

è¿™é‡Œçš„é€»è¾‘ä¹Ÿä¸éš¾ï¼Œåªè¦ç­”æ¡ˆæ˜¯çŸ¥è¯†æ€§çš„å¹¶ä¸”ä¸æ˜¯æ¶ˆæçš„ï¼Œç¬”è€…å°±å°†å…¶ä½œä¸ºäº†ä¸€æ¡é—®ç­”å¯¹ã€‚

### ä¸Šä¼ æ•°æ®

ç„¶åæˆ‘ä»¬å°†æˆ‘ä»¬å¤„ç†åçš„æ•°æ®ä¸Šä¼ è‡³[Google drive](https://drive.google.com/drive/my-drive)è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨ï¼Œä½ ç›´æ¥ä¸Šä¼ åˆ° colab ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡æ–­å¼€è¿æ¥åæ–‡ä»¶å°±æ¶ˆå¤±äº†ï¼Œä½ åˆè¦é‡æ–°ä¸Šä¼ ã€‚

![](https://oss.justin3go.com/blogs/Pasted%20image%2020230426171708.png)

ç„¶åç‚¹å‡»è£…è½½å°±ä¼šå‡ºç°å¯¹åº”çš„æ–‡ä»¶å¤¹ï¼Œæ²¡æœ‰å‡ºæ¥çš„å¯ä»¥ç‚¹å‡»é™„ä»¶çš„æ–‡ä»¶åˆ·æ–°æŒ‰é’®ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨å¯¹åº”çš„æ–‡ä»¶äº†

## å¼€å§‹å¾®è°ƒ

### å¼€å§‹

ç„¶åï¼Œè¾“å…¥å¦‚ä¸‹ä»£ç å°±å¯ä»¥å¼€å§‹å¾®è°ƒäº†ï¼š

```python
!Â openaiÂ apiÂ fine_tunes.createÂ -tÂ "/content/drive/MyDrive/2.jsonl"Â -mÂ ada
```

æ³¨æ„ï¼Œç¬”è€…è¿™é‡Œåªä¸Šä¼ äº†ä¸€ä¸ª`8MB`çš„æ–‡ä»¶ï¼Œå°±èŠ±äº†å…è´¹é¢åº¦çš„ 4 ç¾å…ƒï¼›å¦‚æœä½ ä¹Ÿæ˜¯å…è´¹ç”¨æˆ·ï¼Œä½¿ç”¨æ—¶ä¸èƒ½è¶…è¿‡ 15 ç¾å…ƒï¼Œå³æ•°æ®é›†ä¸èƒ½å¤ªå¤§ï¼ˆç¬”è€…æœ€å¼€å§‹å°±ä¸Šä¼ äº†å…¨éƒ¨æ•°æ®é›† 254MBï¼Œå°±ä¼šæŠ¥é”™ï¼‰

`-m` æ˜¯ä½ å¼€å§‹çš„åŸºæœ¬æ¨¡å‹çš„åç§°ï¼ˆadaã€babbageã€curie æˆ– davinciï¼‰ã€‚[æ‚¨å¯ä»¥ä½¿ç”¨åç¼€å‚æ•°](https://platform.openai.com/docs/guides/fine-tuning/customize-your-model-name)è‡ªå®šä¹‰å¾®è°ƒæ¨¡å‹çš„åç§°ï¼Œada æœ€ä¾¿å®œï¼Œæœ€å¿«ï¼Œç¬”è€…è¿™é‡Œå°è¯•ä¸€ä¸‹å°±æ˜¯ä½¿ç”¨çš„è¿™ä¸ªå‚æ•°ã€‚

![](https://oss.justin3go.com/blogs/Pasted%20image%2020230426172343.png)

### ç›¸å…³å‘½ä»¤

å¾®è°ƒè¿‡ç¨‹ä¸­åªè¦ä»»åŠ¡å·²ç»åˆ›å»ºï¼Œå°±ä¸ä¼šéšè¿™é‡Œ colab çš„å…³é—­è€Œå…³é—­ï¼Œå¦‚ä¸‹æ˜¯æ¢å¤äº‹ä»¶æµçš„ä»£ç ï¼š

```shell
! openai api fine_tunes.follow -i <YOUR_FINE_TUNE_JOB_ID>
```

![](https://oss.justin3go.com/blogs/Pasted%20image%2020230426172705.png)
å¦‚ä¸Šç¬”è€…ç­‰å¾…äº†ä¸€æ®µæ—¶é—´é‡æ–°æŸ¥çœ‹ï¼Œå®ƒå·²ç»è®­ç»ƒå®Œæˆäº†ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥è¾“å…¥æœ€åä¸€è¡Œç»™å‡ºçš„å‘½ä»¤æ¥æ¼”ç¤ºç»“æœ

## ç»“æœæ¼”ç¤º

è¿™é‡Œè¿˜å¯ä»¥ä½¿ç”¨ python è¿›è¡Œè°ƒç”¨ï¼Œå…¶ä»–è¯­è¨€çš„ä½¿ç”¨æ–¹æ³•[è§è¿™](https://platform.openai.com/docs/guides/fine-tuning/use-a-fine-tuned-model)

```python
import openai
result = openai.Completion.create(
    model="<your model>", # ä¸Šé¢æˆªå›¾æœ€åä¸€è¡Œæˆ‘æ‰“ç çš„é‚£éƒ¨åˆ†
    prompt="æˆ‘çœŸçš„å¥½ç´¯ï¼Œå‹åŠ›è¶…çº§è¶…çº§å¤§ï¼Œå‘¨å›´äººéƒ½åœ¨è®¤çœŸå­¦ä¹ ï¼Œæˆ‘æ„Ÿè§‰æˆ‘å°±æ˜¯ä¸€ä¸ªåºŸç‰©",
    max_tokens=1000)

completion = result["choices"][0]["text"]
print(completion.encode("raw_unicode_escape").decode("unicode_escape"))
```

è¿™é‡Œæœ€åæ˜¯åšäº†ä¸€ä¸ª unicode ç¼–ç è½¬ä¸­æ–‡æ˜¾ç¤ºçš„æ“ä½œï¼›

å¦‚ä¸‹æ˜¯æ¼”ç¤ºç»“æœï¼š

![](https://oss.justin3go.com/blogs/Pasted%20image%2020230426173110.png)

æ•ˆæœæœ‰ç‚¹æ‹‰ï¼Œä¸è¿‡ä¹Ÿèƒ½æ¥å—ï¼Œæ¯•ç«Ÿæ•°æ®æ‰ 8MBï¼Œæ¨¡å‹ä¹Ÿæ˜¯ç”¨çš„é‚£ä¸ªæœ€å¿«æœ€ä¾¿å®œçš„ã€‚

## æœ€å

æˆ‘ç­‰ç€é˜¿é‡Œé€šä¹‰åƒé—®çš„ API å‡ºæ¥...ç­‰ä¸åŠäº†ğŸ¤”

å†æ¬¡ç¼–å†™ python ä»£ç ï¼Œå½·ä½›å›åˆ°äº†å¤§ä¸€æš‘å‡åˆšå­¦ python çš„æ—¥å­ï¼Œé‚£æ—¶å€™è¿˜åœ¨ä¸º python çˆ¬è™«çš„ BUG è€Œçƒ¦æ¼ã€‚

## å‚è€ƒ

- [fine-tuning](https://platform.openai.com/docs/guides/fine-tuning)

