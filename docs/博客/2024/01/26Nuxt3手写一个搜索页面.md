# Nuxt3æ‰‹å†™ä¸€ä¸ªæœç´¢é¡µé¢
## å‰è¨€

å‰é¢åšäº†ä¸€ä¸ª[å°å‹æœç´¢å¼•æ“](https://justin3go.com/%E5%8D%9A%E5%AE%A2/2023/08/29%E4%BD%A0%E6%9D%A5%E4%BD%A0%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%81%9A%E4%B8%80%E4%B8%AA%E7%BD%91%E7%9B%98%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E)ï¼Œè™½ç„¶ä¸Šçº¿äº†ï¼Œä½†æ€»ä½“æ¥è¯´è¿˜ç•¥æ˜¾ç²—ç³™ã€‚æ‰€ä»¥æœ€è¿‘èŠ±äº†ç‚¹æ—¶é—´æ‰“ç£¨äº†ä¸€ä¸‹è¿™ä¸ªæœç´¢å¼•æ“çš„å‰ç«¯éƒ¨åˆ†ï¼Œä½¿ç”¨çš„æŠ€æœ¯æ˜¯`Nuxt`ï¼ŒUIç»„ä»¶åº“ä½¿ç”¨çš„æ˜¯`Vuetify`ï¼Œå…³äºUIç»„ä»¶åº“çš„é€‰æ‹©ï¼Œä½ ä¹Ÿå¯ä»¥æŸ¥çœ‹æˆ‘ä¹‹å‰å†™çš„[è¿™ç¯‡å¯¹æ¯”](https://justin3go.com/%E5%8D%9A%E5%AE%A2/2023/08/31%E5%8E%9F%E6%9D%A5Vue%E8%BF%98%E6%9C%89%E8%BF%99%E4%B9%88%E5%A4%9A%E5%A5%BD%E7%94%A8%E7%9A%84UI%E5%BA%93)ã€‚

æœ¬æ–‡ä¸ä¼šä»‹ç»æœç´¢å¼•æ“çš„å…¶ä½™éƒ¨åˆ†ï¼Œç®—æ˜¯ä¸€ç¯‡å‰ç«¯æŠ€æœ¯æ–‡...

**é‡è¦çš„**ï¼š[å¼€æºåœ°å€](https://github.com/Justin3go/SearchSearchGo)ï¼Œåº”ç”¨éƒ¨åˆ†çš„ä»£ç æˆ‘ä¹Ÿç¨å¾®æ•´ç†äº†ä¸€ä¸‹å¼€æºäº†ï¼Œæ•´ä½“æ¥è¯´åç®€å•ï¼Œæ¯•ç«Ÿåªæœ‰ä¸€ä¸ªé¡µé¢ï¼Œç®—æ˜¯çœŸæ­£çš„â€œå•é¡µé¢åº”ç”¨â€äº†ğŸ¤£ğŸ¤£ğŸ¤£

## æ¼”ç¤º

![](https://oss.justin3go.com/blogs/recording.gif)
## ä¸ºä»€ä¹ˆè¦é‡å†™

è¿™æ¬¡é‡å†™çš„ç›®çš„å¦‚ä¸‹ï¼š

1. ä¹‹å‰å†™çš„ä»£ç å¤ªä¹±äº†ï¼ŒåŸºæœ¬ä¸€ä¸ªé¡µé¢å°±åªå†™äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œç»´æŠ¤èµ·æ¥æœ‰ç‚¹å›°éš¾ï¼›
2. ä¹‹å‰çš„åç«¯ä½¿ç”¨nestå•ç‹¬å†™çš„ï¼Œå…¶å®å°±è°ƒè°ƒAPIï¼Œå•ç‹¬èµ·ä¸€ä¸ªåç«¯æœåŠ¡æ„Ÿè§‰æœ‰ç‚¹é‡ï¼›
3. æœ€åä¸€ç‚¹ä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼š**ä½¿ç”¨SSRæ¥ä¼˜åŒ–ä¸€ä¸‹SEO**

å…·ä½“å¦‚ä¸‹ï¼š

1. æ¯”å¦‚å½“ç”¨æˆ·è¾“å…¥æœç´¢ä¹‹åï¼Œå¯¹åº”çš„urlè·¯å¾„ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ¯”å¦‚[https://ssgo.app/?page=1&query=AI](https://ssgo.app/?page=1&query=AI)ï¼Œ
2. å¦‚æœç”¨æˆ·å°†è¯¥urlåˆ†äº«åˆ°å…¶ä»–å¹³å°è¢«æœç´¢å¼•æ“æŠ“å–ä¹‹åï¼Œæœç´¢å¼•æ“å¾—åˆ°çš„æ•°æ®å°†ä¸å†æ˜¯ç©ºç™½çš„æœç´¢æ¡†ï¼Œè€Œæ˜¯åŒ…å«ç›¸å…³èµ„æºçš„ç»“æœé¡µï¼Œ
3. è¿™æ ·æœ‰å¯èƒ½å†ä¸‹ä¸€æ¬¡ç”¨æˆ·åœ¨å…¶ä»–æœç´¢å¼•æ“æœç´¢å¯¹åº”èµ„æºçš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šç›´æ¥è·³è½¬åˆ°è¯¥åº”ç”¨çš„æœç´¢ç»“æœé¡µï¼Œè¿™æ ·å°±å¯ä»¥å¤§å¤§æé«˜è¯¥åº”ç”¨çš„æ›å…‰ç‡ã€‚

è¿™æ ·ï¼Œç”¨æˆ·ä¹‹åä¸ä»…å¯ä»¥é€šè¿‡æœç´¢â€œé˜¿é‡Œäº‘ç›˜æœç´¢å¼•æ“â€èƒ½æœåˆ°è¿™ä¸ªç½‘ç«™ï¼Œè¿˜æœ‰å¯èƒ½é€šè¿‡å…¶ä»–èµ„æºçš„å…³é”®è¯æœç´¢åˆ°è¯¥ç½‘ç«™
## é¡µé¢å¸ƒå±€

é¦–å…ˆå¿…é¡»æ”¯æŒç§»åŠ¨ç«¯ï¼Œå› ä¸ºä»åå°çš„è®¿é—®æ•°æ®çœ‹ï¼Œç§»åŠ¨ç«¯çš„ç”¨æˆ·æ›´å¤šï¼Œæ‰€ä»¥æ•´ä½“å¸ƒå±€ä»¥ç«–å±ä¸ºä¸»ï¼Œè‡³äºå®½å±PCï¼Œåˆ™å¢åŠ ä¸€ä¸ªç±»ä¼¼äº`max-width`çš„æ•ˆæœã€‚

å…¶æ¬¡ä¸ºäº†æ•´ä½“å®ç°ç®€å•ï¼Œé‡‡å–çš„è¿˜æ˜¯æœç´¢æ¡†ä¸æœç´¢ç»“æœå¤„åœ¨ä¸€ä¸ªé¡µé¢ï¼Œè€Œégoogle\baiduä¹‹ç±»çš„æœç´¢æ¡†ä¸»é¡µä¸ç»“æœé¡µåˆ†åˆ«æ˜¯ä¸¤ä¸ªé¡µé¢ï¼Œç¬”è€…æ„Ÿè§‰ä¸»é¡µä¹Ÿæ²¡å•¥å­˜åœ¨çš„å¿…è¦ï¼ˆå•çº¯å¯¹äºæœç´¢åŠŸèƒ½è€Œè¨€ï¼‰

é¡µé¢é™¤äº†æœç´¢æ¡†ã€åˆ—è¡¨é¡¹ï¼Œè¿˜åº”è¯¥æœ‰logoï¼Œèœå•ï¼Œæœ€ç»ˆç»è¿‡æ’ç‰ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://oss.justin3go.com/blogs/Pasted%20image%2020240126140916.png)

å·¦å³ä¸¤è¾¹ä¸ºç§»åŠ¨ç«¯çš„æ•ˆæœæ¼”ç¤ºå›¾ï¼Œä¸­é—´ä¸ºPCç«¯çš„æ•ˆæœæ¼”ç¤ºã€‚

## nitroæœåŠ¡ç«¯éƒ¨åˆ†

è¿™é‡Œåªéœ€è¦å®ç°ä¸¤ä¸ªAPI:

1. æœç´¢æ¥å£ï¼Œå¦‚`/api/search`
2. æœç´¢å»ºè®®çš„æ¥å£ï¼Œå¦‚`/api/search/suggest`

è¯´åˆ°è¿™é‡Œå°±ä¸å¾—ä¸å¤¸ä¸€ä¸‹nuxtçš„å¼€å‘è€…ä½“éªŒï¼Œæ–°å»ºä¸€ä¸ªAPIæ˜¯å¦‚æ­¤çš„æ–¹ä¾¿ï¼š

![](https://oss.justin3go.com/blogs/Pasted%20image%2020240126141529.png)

å¯¹æ¯”nest-cliä¸­æ–°å»ºä¸€ä¸ªservice/controllerè¦å¥½ç”¨ä¸å°‘ï¼Œæ¯•ç«Ÿæˆ‘åœ¨nest-cliä¸­åŸºæœ¬è¦`help`ä¸€ä¸‹ã€‚

å›åˆ°è¿™é‡Œï¼Œæˆ‘çš„serverç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
â”œâ”€api
â”‚  â””â”€search            # æœç´¢æ¥å£ç›¸å…³
â”‚          index.ts    # æœç´¢
â”‚          suggest.ts  # æœç´¢å»ºè®®
â”‚
â””â”€elasticsearch
        index.ts       # eså®¢æˆ·ç«¯
```

åœ¨`elasticsearch`ç›®å½•ä¸­ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªESçš„å®¢æˆ·ç«¯ï¼Œå¹¶åœ¨`search`ä¸­ä½¿ç”¨ï¼š

```ts
// elasticsearch/index.ts

import { Client } from '@elastic/elasticsearch';

export const client = new Client({
  node: process.env.ES_URL,
  auth: {
    username: process.env.ES_AUTH_USERNAME || '',
    password: process.env.ES_AUTH_PASSWORD || ''
  }
});
```

ç„¶åä½¿ç”¨ï¼Œä½¿ç”¨éƒ¨åˆ†åŸºæœ¬ä¸Šæ²¡æœ‰åšä»»ä½•çš„ç‰¹æ®Šé€»è¾‘ï¼Œå°±æ˜¯è°ƒç”¨ES clientæä¾›çš„apiï¼Œç„¶åç»„è£…äº†ä¸€ä¸‹å‚æ•°å°±OKäº†ï¼š

```ts
// api/search/index
import { client } from "~/server/elasticsearch";

interface ISearchQuery {
  pageNo: number;
  pageSize: number;
  query: string;
}

export default defineEventHandler(async (event) => {
  const { pageNo = 1, pageSize = 10, query }: ISearchQuery = getQuery(event);

  const esRes = await client.search({
    index: process.env.ES_INDEX,
    body: {
      from: (pageNo - 1) * pageSize, // ä»å“ªé‡Œå¼€å§‹
      size: pageSize, // æŸ¥è¯¢æ¡æ•°
      query: {
        match: {
          title: query, // æœç´¢æŸ¥è¯¢åˆ°çš„å†…å®¹
        },
      },
      highlight: {
        pre_tags: ["<span class='highlight'>"],
        post_tags: ['</span>'],
        fields: {
          title: {},
        },
        fragment_size: 40,
      },
    },
  });

  const finalRes = {
    took: esRes.body.took,
    total: esRes.body.hits.total.value,
    data: esRes.body.hits?.hits.map((item: any) => ({
      title: item._source.title,
      pan_url: item._source.pan_url,
      extract_code: item._source.extract_code,
      highlight: item.highlight?.title?.[0] || '',
    })),
  };

  return finalRes;
});
```

```ts
// api/search/suggest
import { client } from "~/server/elasticsearch";

interface ISuggestQuery {
  input: string;
}

export default defineEventHandler(async (event) => {
  const { input }: ISuggestQuery = getQuery(event);

  const esRes = await client.search({
    index: process.env.ES_INDEX,
    body: {
      suggest: {
        suggest: {
          prefix: input,
          completion: {
            field: "suggest"
          }
        }
      }
    },
  });

  const finalRes = esRes.body.suggest.suggest[0]?.options.map((item: any) => item._source.suggest)

  return finalRes;
});

```

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå®¢æˆ·ç«¯çš„ESç‰ˆæœ¬éœ€è¦ä¸æœåŠ¡ç«¯çš„ESç‰ˆæœ¬ç›¸äº’å¯¹åº”ï¼Œæ¯”å¦‚æˆ‘æœåŠ¡ç«¯ä½¿ç”¨çš„æ˜¯ES7ï¼Œè¿™è·¯ä¹Ÿå½“ç„¶å¾—ä½¿ç”¨ES7ï¼Œå¦‚æœä½ æ˜¯ES8ï¼Œè¿™é‡Œéœ€è¦å®‰è£…å¯¹åº”ç‰ˆæœ¬å¾—ES8ï¼Œå¹¶ä¸”è¿”å›å‚æ•°æœ‰äº›å˜åŒ–ï¼ŒES8ä¸­ä¸Šè¿°`esRes`å°±æ²¡æœ‰bodyå±æ€§ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨åé¢çš„å±æ€§

## pageç•Œé¢éƒ¨åˆ†

é¦–å…ˆä¸ºäº†é¿å…å‡ºç°ä¹‹å‰æ‰€æœ‰ä»£ç å‡å†™åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™é‡Œç¨å¾®å°è£…äº†å‡ ä¸ªç»„ä»¶ä»¥ä½¿å¾—`page/index`è¿™ä¸ªç»„ä»¶çœ‹èµ·æ¥ç›¸å¯¹ç®€å•ï¼š

```
/components
    BaseEmpty.vue
    DataList.vue
    LoadingIndicator.vue
    MainMenu.vue
    PleaseInput.vue
    RunSvg.vue
    SearchBar.vue
```

å…·ä½“å•¥æ„æ€å°±ä¸èµ˜è¿°äº†ï¼ŒåŸºæœ¬æ ¹æ®æ–‡ä»¶åå°±èƒ½çŒœå¾—å¤§å·®ä¸å·®äº†...

ç„¶åä¸‹é¢å°±æ˜¯æˆ‘çš„ä¸»é¡µé¢éƒ¨åˆ†ï¼š

```vue
<template>
	<div
		class="d-flex justify-center bg-grey-lighten-5 overflow-hidden overflow-y-hidden"
	>
		<v-sheet
			class="px-md-16 px-2 pt-4"
			:elevation="2"
			height="100vh"
			:width="1024"
			border
			rounded
		>
			<v-data-iterator :items="curItems" :page="curPage" :items-per-page="10">
				<template #header>
					<div class="pb-4 d-flex justify-space-between">
						<span
							class="text-h4 font-italic font-weight-thin d-flex align-center"
						>
							<RunSvg style="height: 40px; width: 40px"></RunSvg>
							<span>Search Search Go...</span>
						</span>
						<MainMenu></MainMenu>
					</div>
					<SearchBar
						:input="curInput"
						@search="search"
						@clear="clear"
					></SearchBar>
				</template>
				<template #default="{ items }">
					<v-fade-transition>
						<DataList
							v-if="!pending"
							:items="items"
							:total="curTotal"
							:page="curPage"
							@page-change="pageChange"
						></DataList>
						<LoadingIndicator v-else></LoadingIndicator>
					</v-fade-transition>
				</template>
				<template #no-data>
					<template v-if="!curInput || !pending">
						<v-slide-x-reverse-transition>
							<BaseEmpty v-if="isInput"></BaseEmpty>
						</v-slide-x-reverse-transition>
						<v-slide-x-transition>
							<PleaseInput v-if="!isInput"></PleaseInput>
						</v-slide-x-transition>
					</template>
				</template>
			</v-data-iterator>
		</v-sheet>
	</div>
</template>

<script lang="ts" setup>
const route = useRoute();
const { query = "", page = 1 } = route.query;
const router = useRouter();
const defaultData = { data: [], total: 0 };

const descriptionPrefix = query ? `æ­£åœ¨æœç´¢â€œ ${query} â€... ï¼Œè¿™æ˜¯` : "";
useSeoMeta({
	ogTitle: "SearchSearchGo--æ–°ä¸€ä»£é˜¿é‡Œäº‘ç›˜æœç´¢å¼•æ“",
	ogDescription: `${descriptionPrefix}ä¸€æ¬¾æç®€ä½“éªŒã€ä¼˜é›…ã€ç°ä»£åŒ–ã€èµ„æºä¸°å¯Œã€å…è´¹ã€æ— éœ€ç™»å½•çš„æ–°ä¸€ä»£é˜¿é‡Œäº‘ç›˜æœç´¢å¼•æ“ï¼Œæ¥ä½“éªŒæ‰¾å¯»èµ„æºçš„å¿«ä¹å§~`,
	ogImage: "https://ssgo.app/logobg.png",
	twitterCard: "summary",
});

interface IResultItem {
	title: string;
	pan_url: string;
	extract_code: string;
	highlight: string;
}

interface IResult {
	data: IResultItem[];
	total: number;
}

const curPage = ref(+(page || 1));

const curInput = ref((query || "") as string);
const isInput = computed(() => !!curInput.value);

let { data, pending }: { data: Ref<IResult>; pending: Ref<boolean> } =
	await useFetch("/api/search", {
		query: { query: curInput, pageNo: curPage, pageSize: 10 },
		immediate: !!query,
	});
data.value = data.value || defaultData;

const curItems = computed(() => data.value.data);
const curTotal = computed(() => data.value.total);

function search(input: string) {
	curPage.value = 1;
	curInput.value = input;
	router.replace({ query: { ...route.query, query: input, page: 1 } });
}

function pageChange(page: number) {
	curPage.value = page;
	router.replace({ query: { ...route.query, page: page } });
}

function clear() {
	curInput.value = "";
	data.value = defaultData;
	// è¿™é‡Œå°±ä¸æ›¿æ¢å‚æ•°äº†ï¼Œä¿ç•™ä¸Šä¸€æ¬¡çš„æ„Ÿè§‰å¥½ä¸€äº›
}
</script>
```

å¤§éƒ¨åˆ†ä»£ç éƒ½æ˜¯è°ƒç”¨ç›¸å…³çš„å­ç»„ä»¶ï¼Œä¼ é€’å‚æ•°ï¼Œç›‘å¬äº‹ä»¶ä¹‹ç±»çš„ï¼Œè¿™é‡Œä¹Ÿä¸å¤šè¯´äº†ã€‚æ¯”è¾ƒå…³é”®çš„åœ¨äºè¿™ä¸¤éƒ¨åˆ†ä»£ç ï¼š

```ts
useSeoMeta({
	ogTitle: "SearchSearchGo--æ–°ä¸€ä»£é˜¿é‡Œäº‘ç›˜æœç´¢å¼•æ“",
	ogDescription: `${descriptionPrefix}ä¸€æ¬¾æç®€ä½“éªŒã€ä¼˜é›…ã€ç°ä»£åŒ–ã€èµ„æºä¸°å¯Œã€å…è´¹ã€æ— éœ€ç™»å½•çš„æ–°ä¸€ä»£é˜¿é‡Œäº‘ç›˜æœç´¢å¼•æ“ï¼Œæ¥ä½“éªŒæ‰¾å¯»èµ„æºçš„å¿«ä¹å§~`,
	ogImage: "https://ssgo.app/logobg.png",
	twitterCard: "summary",
});
```

è¿™é‡Œçš„SEOæ˜¾ç¤ºçš„æ–‡å­—æ˜¯åŠ¨æ€çš„ï¼Œæ¯”å¦‚å½“å‰ç”¨æˆ·æ­£åœ¨æœç´¢`AI`ï¼Œé‚£ä¹ˆurlè·¯å¾„å‚æ•°ä¹Ÿä¼šå¢åŠ `AI`ï¼Œåˆ†äº«å‡ºå»çš„é¡µé¢æè¿°å°±ä¼šåŒ…å«`AI`ï¼Œåœ¨twitterä¸­çš„æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š

![](https://oss.justin3go.com/blogs/Pasted%20image%2020240126143423.png)

è¿˜æœ‰éƒ¨åˆ†ä»£ç æ˜¯è¿™ä¸€éƒ¨åˆ†ï¼š

```ts
let { data, pending }: { data: Ref<IResult>; pending: Ref<boolean> } =
	await useFetch("/api/search", {
		query: { query: curInput, pageNo: curPage, pageSize: 10 },
		immediate: !!query,
	});
```

å…¶ä¸­`immediate: !!query`è¡¨ç¤ºå¦‚æœå½“å‰è·¯å¾„åŒ…å«æœç´¢è¯ï¼Œåˆ™ä¼šè¯·æ±‚æ•°æ®ï¼Œæ¸²æŸ“ç»“æœé¡µï¼Œå¦åˆ™ä¸ç«‹å³æ‰§è¡Œè¯¥è¯·æ±‚ï¼Œè€Œæ˜¯ç­‰ä¸€äº›å“åº”å¼å˜é‡å¦‚`curInput`ã€ `curPage`å‘ç”Ÿå˜åŒ–åæ‰§è¡Œè¯·æ±‚ã€‚

å­ç»„ä»¶éƒ¨åˆ†è¿™é‡Œå°±ä¸è¯¦ç»†è§£é‡Šäº†ï¼Œå…·ä½“å¯ä»¥[æŸ¥çœ‹æºç ](https://github.com/Justin3go/SearchSearchGo)ï¼Œæ•´ä½“æ¥è¯´å¹¶ä¸æ˜¯å¾ˆå¤æ‚ã€‚

## å…¶ä»–

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘è¿˜å¢åŠ äº†google analyticså’Œç™¾åº¦ analyticsï¼Œä»£ç éƒ½éå¸¸ç®€å•ï¼Œåœ¨`plugins/`ç›®å½•ä¸‹ï¼Œå¦‚æœä½ éœ€è¦ä½¿ç”¨è¯¥é¡¹ç›®ï¼Œè®°å¾—å°†å¯¹åº”çš„idæ”¹ä¸ºä½ è‡ªå·±çš„idã€‚
## æœ€å

è¿™æ¬¡ä¹Ÿç®—æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨nuxtæ¥å¼€å‘ä¸€ä¸ªåº”ç”¨ï¼Œæ€»ä½“æ¥è¯´å®‰è£…äº†nuxtæ’ä»¶ä¹‹åçš„å¼€å‘ä½“éªŒéå¸¸ä¸é”™ï¼ŒæŒ‰ç…§ç›®å½•è§„èŒƒå†™ä»£ç ä¹Ÿå¯ä»¥å°‘æ‰å¾ˆå¤šå¯¼å…¥å¯¼å‡ºçš„ä¸€ä¸²ä¸²ä¸‘ä»£ç ã€‚

> å…³äºç¬”è€…--[justin3go.com](https://justin3go.com/)